
/* Drop Tables */

DROP TABLE IF EXISTS REGION;
DROP TABLE IF EXISTS CFU;
DROP TABLE IF EXISTS INSERTION;
DROP TABLE IF EXISTS SPOT_RESPONSE;
DROP TABLE IF EXISTS PUBLIC.ACCESS_OUTOFTIME;
DROP TABLE IF EXISTS PUBLIC.CADASTRO_PARTICIPANTE;
DROP TABLE IF EXISTS PUBLIC.CDR;
DROP TABLE IF EXISTS PUBLIC.MSISDN_CAMPANHA;
DROP TABLE IF EXISTS PUBLIC.CAMPANHA;
DROP TABLE IF EXISTS PUBLIC.SPOT_AUDIO_FILES;
DROP TABLE IF EXISTS PUBLIC.SPOT;
DROP TABLE IF EXISTS PUBLIC.ANUNCIANTE;
DROP TABLE IF EXISTS PUBLIC.AGENCIA;
DROP TABLE IF EXISTS PUBLIC.ESTIMULO;
DROP TABLE IF EXISTS PUBLIC.LISTA_GERAL;
DROP TABLE IF EXISTS PUBLIC.SPOT_TIPO;
DROP TABLE IF EXISTS PUBLIC.STATISTIC;
DROP TABLE IF EXISTS PUBLIC.USER_ACCESS;
DROP TABLE IF EXISTS PUBLIC.USER_TYPE;



/* Drop Sequences */

DROP SEQUENCE IF EXISTS PUBLIC.ACCESS_OUTOFTIME_ID_LIST_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.AGENCIA_ID_AGENCIA_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.ANUNCIANTE_ID_ANUNCIANTE_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.CADASTRO_PARTICIPANTE_ID_CADASTRO_PARTICIPANTE_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.CAMPANHA_ID_CAMPANHA_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.CDR_ID_CDR_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.ESTIMULO_ID_ESTIMULO_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.LISTA_GERAL_ID_LIST_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.MSISDN_CAMPANHA_ID_MSISDN_CAMPANHA_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.PERMISSAO_ID_PERMISSAO_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.SPOT_AUDIO_FILES_ID_SPOT_AUDIO_FILES_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.SPOT_CAMPANHA_MSISDN_ID_SPOT_CAMPANHA_MSISDN_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.SPOT_ID_SPOT_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.SPOT_TIPO_ID_SPOT_TIPO_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.STATS_ID_STAT_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.USER_ACCESS_ID_USER_ACCESS_SEQ;
DROP SEQUENCE IF EXISTS PUBLIC.USER_TYPE_ID_USER_TYPE_SEQ;




/* Create Sequences */

CREATE SEQUENCE PUBLIC.PERMISSAO_ID_PERMISSAO_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1;
CREATE SEQUENCE PUBLIC.SPOT_CAMPANHA_MSISDN_ID_SPOT_CAMPANHA_MSISDN_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1;
CREATE SEQUENCE PUBLIC.STATS_ID_STAT_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START 1 CACHE 1;



/* Create Tables */

CREATE TABLE CFU
(
	ID_CFU BIGSERIAL NOT NULL,
	CFU_CODE VARCHAR(12) NOT NULL UNIQUE,
	CFU_DESCRIPTION VARCHAR(50) NOT NULL,
	PRIMARY KEY (ID_CFU)
) WITHOUT OIDS;


CREATE TABLE INSERTION
(
	ID_INSERTION BIGSERIAL NOT NULL,
	ID_CAMPANHA BIGINT NOT NULL,
	DAY_OF_WEEK INT NOT NULL,
	START_TIME TIME,
	END_TIME TIME,
	PRIMARY KEY (ID_INSERTION)
) WITHOUT OIDS;


CREATE TABLE REGION
(
	ID_REGION BIGSERIAL NOT NULL,
	ID_CAMPANHA BIGINT NOT NULL,
	ID_CFU BIGINT NOT NULL,
	PRIMARY KEY (ID_REGION)
) WITHOUT OIDS;


CREATE TABLE SPOT_RESPONSE
(
	ID_SPOT_RESPONSE BIGSERIAL NOT NULL,
	ID_MSISDN_CAMPANHA BIGINT NOT NULL,
	ID_SPOT_AUDIO_FILES BIGINT NOT NULL,
	RESPONSE VARCHAR(25) NOT NULL,
	PRIMARY KEY (ID_SPOT_RESPONSE)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.ACCESS_OUTOFTIME
(
	ID_LIST BIGSERIAL NOT NULL,
	INSERTED_DATE TIMESTAMP,
	MSISDN VARCHAR(15),
	CONSTRAINT access_outoftime_pkey PRIMARY KEY (ID_LIST)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.AGENCIA
(
	ID_AGENCIA BIGSERIAL NOT NULL,
	OPERATION_DATE TIMESTAMP,
	EMAIL VARCHAR(255),
	NOME_CONTATO VARCHAR(255),
	QUANTIDADE_CAMPANHAS INT,
	QUANTIDADE_VEICULACOES INT,
	RAZAO_SOCIAL VARCHAR(255),
	STATUS INT,
	TELEFONE VARCHAR(255),
	ID_USER_ACCESS BIGINT,
	CONSTRAINT agencia_pkey PRIMARY KEY (ID_AGENCIA)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.ANUNCIANTE
(
	ID_ANUNCIANTE BIGSERIAL NOT NULL,
	OPERATION_DATE TIMESTAMP,
	EMAIL VARCHAR(255),
	NOME_CONTATO VARCHAR(255),
	RAZAO_SOCIAL VARCHAR(255),
	STATUS INT,
	TELEFONE VARCHAR(255),
	IDAGENCIA BIGINT,
	ID_USER_ACCESS BIGINT,
	CONSTRAINT anunciante_pkey PRIMARY KEY (ID_ANUNCIANTE)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.CADASTRO_PARTICIPANTE
(
	ID_CADASTRO_PARTICIPANTE BIGSERIAL NOT NULL,
	OPERATION_DATE TIMESTAMP,
	MSISDN VARCHAR(15),
	OPCAO_ESCOLHA INT,
	TEXTO_SMS VARCHAR(255),
	ID_CAMPANHA BIGINT,
	CONSTRAINT cadastro_participante_pkey PRIMARY KEY (ID_CADASTRO_PARTICIPANTE)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.CAMPANHA
(
	ID_CAMPANHA BIGSERIAL NOT NULL,
	ID_SPOT BIGINT,
	OPERATION_DATE TIMESTAMP,
	START_DATATIME TIMESTAMP,
	END_DATETIME TIMESTAMP,
	DESCRIPTION VARCHAR(255),
	PRIORITY INT,
	NAME VARCHAR(255),
	INSERTION_REACH BIGINT,
	INSERTION_CONTRACTED BIGINT,
	STATUS INT,
	NEXT_CAMPAIGN BOOLEAN,
	CALL_DURATION INT,
	CONSTRAINT campanha_pkey PRIMARY KEY (ID_CAMPANHA)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.CDR
(
	ID_CDR BIGSERIAL NOT NULL,
	ID_CAMPANHA BIGINT,
	CALL_DATETIME TIMESTAMP,
	ANSWER_DATETIME TIMESTAMP,
	DURATION INT,
	MSISDN_ORIGINATOR VARCHAR(15),
	DESTINATION_CALL VARCHAR(20),
	HANGUP_CAUSE INT,
	CONSTRAINT cdr_pkey PRIMARY KEY (ID_CDR)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.ESTIMULO
(
	ID_ESTIMULO BIGSERIAL NOT NULL,
	CLIENTES_EFETIVAMENTE_IMPACTADOS BIGINT,
	CLIENTES_IMPACTADOS BIGINT,
	OPERATION_DATE TIMESTAMP,
	CONSTRAINT estimulo_pkey PRIMARY KEY (ID_ESTIMULO)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.LISTA_GERAL
(
	ID_LIST BIGSERIAL NOT NULL,
	INSERTED_DATE TIMESTAMP,
	MSISDN VARCHAR(15),
	CONSTRAINT lista_geral_pkey PRIMARY KEY (ID_LIST)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.MSISDN_CAMPANHA
(
	ID_MSISDN_CAMPANHA BIGSERIAL NOT NULL,
	ID_CAMPANHA BIGINT,
	MSISDN VARCHAR(15),
	OPERATION_DATE TIMESTAMP,
	CONSTRAINT msisdn_campanha_pkey PRIMARY KEY (ID_MSISDN_CAMPANHA)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.SPOT
(
	ID_SPOT BIGSERIAL NOT NULL,
	ID_ANUNCIANTE BIGINT,
	SPOT_NAME VARCHAR(255),
	MESSAGE_SMS VARCHAR(255),
	SERVER_SMS VARCHAR(255),
	OPERATION_DATE TIMESTAMP,
	SPOT_CONFIRM_DIGIT VARCHAR(255),
	PRICE NUMERIC(19,2),
	CONSTRAINT spot_pkey PRIMARY KEY (ID_SPOT)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.SPOT_AUDIO_FILES
(
	ID_SPOT_AUDIO_FILES BIGSERIAL NOT NULL,
	ID_SPOT BIGINT,
	OPERATION_DATE TIMESTAMP,
	SPOT_FILENAME VARCHAR(255) NOT NULL,
	SPOT_AUDIO_DESCRIPTION VARCHAR(50) NOT NULL,
	SPOT_AUDIO_ORDER INT NOT NULL,
	CONSTRAINT spot_audio_files_pkey PRIMARY KEY (ID_SPOT_AUDIO_FILES)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.SPOT_TIPO
(
	ID_SPOT_TIPO BIGSERIAL NOT NULL,
	CODE_SPOT_TIPO BIGINT,
	NOME_SPOT_TIPO VARCHAR(255),
	SPOT_ACTION VARCHAR(255),
	CONSTRAINT spot_tipo_pkey PRIMARY KEY (ID_SPOT_TIPO)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.STATISTIC
(
	ID_STAT BIGSERIAL NOT NULL,
	ACTIVATION_SENT VARCHAR(2),
	ANNOUNCE_STATUS_PLAY VARCHAR(2),
	CALL_COMPLETED BOOLEAN,
	CALL_DURATION BIGINT,
	DIGIT_SELECTED VARCHAR(1),
	FIRST_ACCESS BOOLEAN,
	ID_CAMPANHA BIGINT,
	ID_CDR BIGSERIAL,
	ID_SPOT BIGINT,
	MSISDN VARCHAR(15),
	OPERATION_DATE TIMESTAMP,
	CONSTRAINT statistic_pkey PRIMARY KEY (ID_STAT)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.USER_ACCESS
(
	ID_USER_ACCESS BIGSERIAL NOT NULL,
	LOGIN VARCHAR(255),
	PASSWORD VARCHAR(255),
	STATUS INT,
	ID_USER_TYPE BIGINT,
	CONSTRAINT user_access_pkey PRIMARY KEY (ID_USER_ACCESS)
) WITHOUT OIDS;


CREATE TABLE PUBLIC.USER_TYPE
(
	ID_USER_TYPE BIGSERIAL NOT NULL,
	CODE_USER_TYPE VARCHAR(255),
	EMAIL VARCHAR(255),
	NAME_USER_TYPE VARCHAR(255),
	CONSTRAINT user_type_pkey PRIMARY KEY (ID_USER_TYPE)
) WITHOUT OIDS;



/* Create Foreign Keys */

ALTER TABLE REGION
	ADD FOREIGN KEY (ID_CFU)
	REFERENCES CFU (ID_CFU)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.ANUNCIANTE
	ADD CONSTRAINT FK_ANUNCIANTE_IDAGENCIA FOREIGN KEY (IDAGENCIA)
	REFERENCES PUBLIC.AGENCIA (ID_AGENCIA)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.ANUNCIANTE
	ADD CONSTRAINT FK9FC98FEA8A7B71F8 FOREIGN KEY (IDAGENCIA)
	REFERENCES PUBLIC.AGENCIA (ID_AGENCIA)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.SPOT
	ADD CONSTRAINT FK_SPOT_ID_ANUNCIANTE FOREIGN KEY (ID_ANUNCIANTE)
	REFERENCES PUBLIC.ANUNCIANTE (ID_ANUNCIANTE)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.SPOT
	ADD CONSTRAINT FK35F9023028A1FD FOREIGN KEY (ID_ANUNCIANTE)
	REFERENCES PUBLIC.ANUNCIANTE (ID_ANUNCIANTE)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE INSERTION
	ADD FOREIGN KEY (ID_CAMPANHA)
	REFERENCES PUBLIC.CAMPANHA (ID_CAMPANHA)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE REGION
	ADD FOREIGN KEY (ID_CAMPANHA)
	REFERENCES PUBLIC.CAMPANHA (ID_CAMPANHA)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.CADASTRO_PARTICIPANTE
	ADD CONSTRAINT FK_CADASTRO_PARTICIPANTE_ID_CAMPANHA FOREIGN KEY (ID_CAMPANHA)
	REFERENCES PUBLIC.CAMPANHA (ID_CAMPANHA)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.CDR
	ADD CONSTRAINT FK_CDR_ID_CAMPANHA FOREIGN KEY (ID_CAMPANHA)
	REFERENCES PUBLIC.CAMPANHA (ID_CAMPANHA)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.MSISDN_CAMPANHA
	ADD CONSTRAINT FK_MSISDN_CAMPANHA_ID_CAMPANHA FOREIGN KEY (ID_CAMPANHA)
	REFERENCES PUBLIC.CAMPANHA (ID_CAMPANHA)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE SPOT_RESPONSE
	ADD FOREIGN KEY (ID_MSISDN_CAMPANHA)
	REFERENCES PUBLIC.MSISDN_CAMPANHA (ID_MSISDN_CAMPANHA)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.CAMPANHA
	ADD CONSTRAINT FK_CAMPANHA_ID_SPOT FOREIGN KEY (ID_SPOT)
	REFERENCES PUBLIC.SPOT (ID_SPOT)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.CAMPANHA
	ADD CONSTRAINT FKFB837807E7176F2D FOREIGN KEY (ID_SPOT)
	REFERENCES PUBLIC.SPOT (ID_SPOT)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.SPOT_AUDIO_FILES
	ADD CONSTRAINT FK_SPOT_AUDIO_FILES_ID_SPOT FOREIGN KEY (ID_SPOT)
	REFERENCES PUBLIC.SPOT (ID_SPOT)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE SPOT_RESPONSE
	ADD FOREIGN KEY (ID_SPOT_AUDIO_FILES)
	REFERENCES PUBLIC.SPOT_AUDIO_FILES (ID_SPOT_AUDIO_FILES)
	ON UPDATE RESTRICT
	ON DELETE RESTRICT
;


ALTER TABLE PUBLIC.AGENCIA
	ADD CONSTRAINT FK23FAFAEC88E48108 FOREIGN KEY (ID_USER_ACCESS)
	REFERENCES PUBLIC.USER_ACCESS (ID_USER_ACCESS)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.AGENCIA
	ADD CONSTRAINT FK_AGENCIA_ID_USER_ACCESS FOREIGN KEY (ID_USER_ACCESS)
	REFERENCES PUBLIC.USER_ACCESS (ID_USER_ACCESS)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.ANUNCIANTE
	ADD CONSTRAINT FK9FC98FEA88E48108 FOREIGN KEY (ID_USER_ACCESS)
	REFERENCES PUBLIC.USER_ACCESS (ID_USER_ACCESS)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.ANUNCIANTE
	ADD CONSTRAINT FK_ANUNCIANTE_ID_USER_ACCESS FOREIGN KEY (ID_USER_ACCESS)
	REFERENCES PUBLIC.USER_ACCESS (ID_USER_ACCESS)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.USER_ACCESS
	ADD CONSTRAINT FKD760FC58F5D2C4B4 FOREIGN KEY (ID_USER_TYPE)
	REFERENCES PUBLIC.USER_TYPE (ID_USER_TYPE)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;


ALTER TABLE PUBLIC.USER_ACCESS
	ADD CONSTRAINT FK_USER_ACCESS_ID_USER_TYPE FOREIGN KEY (ID_USER_TYPE)
	REFERENCES PUBLIC.USER_TYPE (ID_USER_TYPE)
	ON UPDATE NO ACTION
	ON DELETE NO ACTION
;



